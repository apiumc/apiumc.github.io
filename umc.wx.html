<!doctype html>
<html>

<head>
    <title>顾家数据平台</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

    <link href="css/weui.css" rel="stylesheet" type="text/css" />
    <link href="css/base.css" rel="stylesheet" type="text/css" />
    <link href="css/icon.css" rel="stylesheet" type="text/css" />
    <link href="css/umc.ui.css" rel="stylesheet" type="text/css" />
    <!-- <link href="css/umc.css" rel="stylesheet" type="text/css" /> -->

    <link href="css/mobile.css?v.17" rel="stylesheet" type="text/css" />
    <script src="js/umc.js" type="text/javascript"></script>
    <script>
        WDK.UI.Config({
            "posurl": "https://data.kukahome.com/EXP/" + (WDK.cookie('device') || WDK.cookie('device', WDK.uuid()))
        });
        // WDK.UI.Config({
        //     "posurl": "http://192.168.210.160:8010/UMC/" + (WDK.cookie('device') || WDK.cookie('device', WDK.uuid()))
        // });
        WDK.Src = 'https://oss.365lu.cn/v0.1/';
        // WDK.Src = '/';
    </script>
    <script src="js/umc.date.js"></script>
    <script src="js/umc.database.js"></script>
    <script src="js/umc.grid.js"></script>
    <script src="js/umc.dialog.js"></script>
    <script src="js/umc.ui.js"></script>
    <script src="js/umc.page.js"></script>

    <style>
        .weui_tab_bd .wdk-section-header+.weui_cells {
            margin-top: 0px;
        }
        
        .weui_cell {
            padding: 15px;
        }
        
        .wdk_cell_icon::before {
            font-size: 18px;
        }
        
        .weui_tabbar_icon {
            margin: 0 auto;
            width: 34px;
            height: 34px;
        }
        
        div[ui=main] .weui_tabbar_icon::before {
            font-size: 24px;
        }
        
        .wdk-icon img {
            width: 40px;
            height: 40px;
            border-radius: 0px;
        }
        
        .wdk-icon ul {
            padding: 12px 0;
        }
        
        a.weui_cell[href]:after,
        .weui_cell[click-data]:after {
            display: none;
        }
    </style>

    <script>
        WDK.UI.Bridge = function(v, fn) {
            var xhr = new XMLHttpRequest();
            xhr.onload = function() {
                fn(JSON.parse(xhr.responseText));
            }
            var srcs = [WDK.UI.Config().posurl, '?', v.replace(/^&+/, '')];
            xhr.open("POST", srcs.join(''));
            xhr.send('');

        }
    </script>
    <script>
        ($ => {

            $.UI.On('UI.Push', function(e, xhr) {

                var app = $(document.body);
                app.children('div[ui].ui').cls('ui', false).remove().on('backstage');
                app.append(xhr.root.cls('ui', true).on('active'));
            }).Off('Prompt').On("Prompt", function(e, p) {
                alert(p.Text);
            });

            WDK.page('main', '主页', false, function(root, title, menu) {

                var tabData = [{
                    "text": "收藏",
                    cmd: 'Favorite',
                    //     RefreshEvent: 'Favorite',
                    model: 'Exp',
                    "icon": "\uf1b3"
                }, {
                    "text": "主题看板",
                    cmd: 'Menu',
                    model: 'Exp',
                    "icon": "\uf200"
                }];
                var tabs = [];
                $(document.body).ui('Key.Report', function(e, item) {
                    location.hash = 'Exp?key=' + item.Key;
                });
                // console.log(arguments);)
                root.ui('Key.Report', function(e, item) {
                    location.hash = 'Exp?key=' + item.Key;
                    // console.log(arguments);
                }).ui('Favorite', function() {
                    tabs[0].query();
                }, true);

                var weui_tab = $('.weui_tab_bd', root);
                var tabbar = $('.weui_tabbar', root)
                    .on('click', 'a.weui_tabbar_item', function(e, auto) {
                        var me = $(this);
                        var index = parseInt(me.attr('data-index')) || 0;

                        if (!me.is('.weui_bar_item_on')) {

                            me.addClass('weui_bar_item_on').siblings('a').removeClass('weui_bar_item_on');

                            var body = weui_tab.children('div').eq(index);
                            body.css('display', 'flex').siblings('div').hide();
                            var data = tabData[index];
                            if (!body.attr('data-init')) {
                                body.attr('data-init', "Y");
                                body.html('<section style="flex: 1; overflow: auto"></section>')

                                var pager = new WDK.UI.Pager(body);
                                tabs.push(pager);
                                pager.model = data.model;
                                pager.cmd = data.cmd;
                                pager.search = data.search || {};
                                pager.query();
                            }

                        }
                        return false;
                    });
                tabbar.format(tabData, true)
                weui_tab.format(tabData, true);
                tabbar.find('a').each(function(i) {
                    var d = tabData[i];
                    var m = $(this).attr('data-index', i + '');

                    if (d.max) {
                        m.addClass('wdk-max-bar')
                    }
                }).eq(0).click(true);
            }).page('Exp', 'Exp', function(root) {
                root.on('hash', function(e, v) {
                    $('iframe', root).attr('src', [WDK.UI.Config().posurl, '/Exp/Report/', v.key].join(''))
                });
            });
            WDK.UI.On("Check.Pass", function() {
                location.reload();
            }).On("User", function() {
                $(window).on('popstate');
            }).On('Login', function(e, x) {
                location.href = x.wxUrl;
            });;
            $(function() {
                if (location.search) {
                    var value = WDK.query(location.search.substring(1) || 'main');
                    if (value.code) {
                        WDK.UI.Command('Exp', "Login", {
                            type: 'WxCorp',
                            Code: value.code
                        })
                        return;
                    }

                }

                WDK.UI.Command('Exp', "Login", 'Check');

            });
        })(WDK);
    </script>
</head>

<body>
    <div ui="Exp">
        <iframe frameborder="0" style="width: 100vw; height: 100vh;"></iframe>
    </div>
    <div ui="main">
        <div class="weui_tab">
            <div class="weui_tab_bd">
                <script type="text/html">
                    <div class="wdk-tab-body-item">
                    </div>
                </script>
            </div>
            <footer class="weui_tabbar">
                <script type="text/html">
                    <a href="javascript:;" data-key="{key}" class="weui_tabbar_item">
                        <div class="weui_tabbar_icon" data-icon="{icon}"></div>
                        <p class="weui_tabbar_label">{text}</p>
                    </a>
                </script>
            </footer>
        </div>
    </div>
</body>

</html>